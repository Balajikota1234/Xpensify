<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="reports.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="icon" type="image/x-icon" href="./Favicon.png">
  <title>Xpensify</title>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800">
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Reports</h1>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="card">
        <div>
          <p class="label">This Month's Expenses</p>
          <p class="value" id="monthly-expense">&#8377; 0</p>
        </div>
        <span class="badge" id="current-month">Month</span>
      </div>

      <div class="card">
        <div>
          <p class="label">Monthly Average</p>
          <p class="value" id="monthly-average">&#8377; 0</p>
        </div>
        <span class="badge">All Time</span>
      </div>
    </div>

  <div class="flex flex-col md:flex-row gap-6 mb-8">
  <!-- Monthly Trends -->
  <div class="card flex-1 flex-col items-start">
    <h2 class="section-title">Monthly Trends</h2>
    <canvas id="trendChart" class="w-full h-64"></canvas>
  </div>

  <!-- All-Time Breakdown -->
  <div class="card flex-1 flex-col items-start">
    <h2 class="section-title">All-Time Breakdown</h2>
    <canvas id="breakdownChart" class="w-84 h-84 mx-auto"></canvas>
  </div>
  </div>
  </div><br><br>

  <div id="bottom-nav"></div>

  <script>
    const expenses = JSON.parse(localStorage.getItem("expenses")) || [];

    const thisMonth = new Date().toISOString().slice(0, 7); // "YYYY-MM"
    const monthlyExpenses = expenses.filter(e => e.date.startsWith(thisMonth));
    const monthlyTotal = monthlyExpenses.reduce((sum, e) => sum + e.amount, 0);

    document.getElementById("monthly-expense").textContent = `₹ ${monthlyTotal.toFixed(2)}`;
    document.getElementById("current-month").textContent = new Date().toLocaleString('default', { month: 'long' });

    const allMonths = {};
    expenses.forEach(e => {
      const month = e.date.slice(0, 7);
      allMonths[month] = (allMonths[month] || 0) + e.amount;
    });

    const allMonthsValues = Object.values(allMonths);
    const monthlyAvg = allMonthsValues.reduce((a, b) => a + b, 0) / allMonthsValues.length;
    document.getElementById("monthly-average").textContent = `₹ ${monthlyAvg.toFixed(2)}`;

    // Monthly Trend Chart
    const ctxTrend = document.getElementById('trendChart').getContext('2d');
    new Chart(ctxTrend, {
      type: 'bar',
      data: {
        labels: Object.keys(allMonths),
        datasets: [{
          label: 'Monthly Expenses',
          data: Object.values(allMonths),
          backgroundColor: '#4f46e5'
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // Category Breakdown
    const categoryData = {};
    expenses.forEach(e => {
      categoryData[e.category] = (categoryData[e.category] || 0) + e.amount;
    });

    const ctxBreakdown = document.getElementById('breakdownChart').getContext('2d');
    new Chart(ctxBreakdown, {
      type: 'doughnut',
      data: {
        labels: Object.keys(categoryData),
        datasets: [{
          data: Object.values(categoryData),
          backgroundColor: [
            '#ef4444', '#10b981', '#3b82f6', '#f59e0b', '#8b5cf6',
            '#ec4899', '#22d3ee', '#f97316', '#84cc16', '#6366f1', '#14b8a6', '#eab308'
          ]
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
      }
    });

    fetch("nav.html")
      .then(response => response.text())
      .then(data=>{

        document.getElementById("bottom-nav").innerHTML= data;

        // Detect current page name
    const currentPage = window.location.pathname.split("/").pop();

    // Get all nav items
    const navItems = document.querySelectorAll(".nav-item");

    navItems.forEach(item => {
      const href = item.getAttribute("href");
      if (href === currentPage) {
        item.classList.add("active");
      } else {
        item.classList.remove("active");
      }
    });

      })
      .catch(error=>console.error("Error loading bottom-nav.",error));
  </script>
</body>
</html>
